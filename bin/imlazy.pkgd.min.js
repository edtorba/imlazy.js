/*!
 * Imlazy.js PACKAGED v1.3.0
 * A lightweight vanilla JS plugin to lazy load images.
 *
 * Licensed MIT License (MIT)
 *
 * http://edtorba.com
 * Copyright 2016 Eduards Torba
 */
function Imlazy(t){this.defaults={preload:0},this.events={},this.defaults=Object.assign(this.defaults,t),this.run=this.run.bind(this),this.run(),this.run=this.debounce(this.run,20),window.addEventListener("resize",this.run,!1),window.addEventListener("scroll",this.run,!1),document.body.addEventListener("scroll",this.run,!1)}var proto=Imlazy.prototype;proto.run=function(){this.imageBucket=document.querySelectorAll("[data-imlazy]");for(var t=0,e=this.imageBucket.length;t<e;t++){var n=this.imageBucket[t];this.isElementInView(n)&&this.load(n)}},proto.load=function(t){var e=t.getAttribute("data-imlazy"),n=window.innerWidth,o=null;if(null===e)return void console.error("imlazy: Couldn't retrieve JSON data for ",t);var i=this.parseJSON(e);if(void 0!==i){for(var s in i){var r=parseInt(s,10);r<=n&&(o=r)}var a=this;if(this.isImageElement(t))t.getAttribute("src")!==i[o]&&(t.setAttribute("src",i[o]),t.onload=function(e){a.classlist.contains(t,"is-loaded")||a.classlist.add(t,"is-loaded"),a.dispatchEvent("lazyload",[{ok:!0},t])},t.onerror=function(e){console.error("imlazy: Couldn't load ",i[o]),a.dispatchEvent("lazyload",[{ok:!1},t])});else if(t.style.backgroundImage.slice(4,-1).replace(/"/g,"")!==i[o]){var l=new Image;l.setAttribute("src",i[o]),t.style.backgroundImage="url("+i[o]+")",l.onload=function(e){a.classlist.contains(t,"is-loaded")||a.classlist.add(t,"is-loaded"),a.dispatchEvent("lazyload",[{ok:!0},t])},l.onerror=function(e){console.error("imlazy: Couldn't load ",i[o]),a.dispatchEvent("lazyload",[{ok:!1},t])}}}},proto.isElementInView=function(t,e){var n=t.getBoundingClientRect();return this.defaults.preload?n.bottom>0-this.defaults.preload&&n.top<(window.innerHeight||document.documentElement.clientHeight)+this.defaults.preload:n.bottom>0&&n.top<(window.innerHeight||document.documentElement.clientHeight)},proto.isImageElement=function(t){return t instanceof HTMLImageElement},proto.parseJSON=function(t){try{return JSON.parse(t)}catch(t){console.error("parseJson error: %s",t)}},proto.on=function(t,e){this.events.hasOwnProperty(t)?this.events[t].push(e):this.events[t]=[e]},proto.off=function(t,e){if(this.events.hasOwnProperty(t)){var n=this.events[t].indexOf(e);n!==-1&&this.events[t].splice(n,1)}},proto.dispatchEvent=function(t,e){if(this.events.hasOwnProperty(t)){e&&e.length||(e=[]);for(var n=this.events[t],o=0,i=n.length;o<i;o++)n[o].apply(null,e)}},proto.classlist={add:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];if(t.classList)for(var i=0,s=n.length;i<s;i++)t.classList.add(n[i]);else for(var r=0,a=n.length;r<a;r++)t.className+=" "+n[r]},contains:function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}},proto.debounce=function(t,e,n){var o;return function(){var i=this,s=arguments,r=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||t.apply(i,s)},e),r&&t.apply(i,s)}},window.Imlazy=Imlazy,"assign"in Object||(Object.assign=function(t,e){for(var n,o,i=1;i<arguments.length;++i){o=arguments[i];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t});